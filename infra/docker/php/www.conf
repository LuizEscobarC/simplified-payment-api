; =================================================================================
; CONFIGURAÇÃO PHP-FPM PARA RESOLVER 504 GATEWAY TIMEOUT
; =================================================================================
;
; PROBLEMA IDENTIFICADO:
; - PHP-FPM terminando processos antes do processamento completo
; - Consultas pesadas no InfluxDB causando timeout no worker
; - Processamento intensivo de dados requerendo mais tempo
;
; SOLUÇÕES IMPLEMENTADAS:
; 1. request_terminate_timeout aumentado para 7200s (2 horas)
; 2. Pool de workers otimizado para alta carga
; 3. Slowlog habilitado para monitoramento de queries lentas
;
; CONFIGURAÇÕES DE PERFORMANCE:
; - pm.max_children: 50 (máximo de processos filhos)
; - pm.start_servers: 10 (processos inicializados)
; - pm.min_spare_servers: 5 (mínimo de processos ociosos)
; - pm.max_spare_servers: 20 (máximo de processos ociosos)
; - request_terminate_timeout: 7200s (2h para terminar requisição)
; - request_slowlog_timeout: 600s (10min para log de queries lentas)
;
; MONITORAMENTO:
; - slowlog: /var/log/php-fpm-slow.log (log de queries lentas)
;
; =================================================================================

[www]

user = www-data
group = www-data

listen = /var/run/php/php8.1-fpm.sock
listen.owner = www-data
listen.group = www-data

pm = dynamic
pm.max_children = 50
pm.start_servers = 10
pm.min_spare_servers = 5
pm.max_spare_servers = 20

request_terminate_timeout = 7200
request_slowlog_timeout = 600

slowlog = /var/log/php-fpm-slow.log
