#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üî¨ Executando an√°lise est√°tica completa..."

# Function to run command
run_command() {
    local cmd="$1"
    if [ -f /var/www/html/composer.json ]; then
        eval "$cmd"
    else
        if docker ps | grep -q payment-api; then
            docker exec payment-api sh -c "cd /var/www/html && $cmd"
        else
            cd api && eval "$cmd"
        fi
    fi
}

# PHPStan
echo "üîç Executando PHPStan..."
run_command "./vendor/bin/phpstan analyse app --memory-limit=-1" || {
    echo "‚ùå PHPStan encontrou erros. Corrija antes de fazer push."
    exit 1
}

echo "‚úÖ An√°lise est√°tica conclu√≠da!"
